<!DOCTYPE html>
<html>
   <head>
    <style>
      html {
        margin: 0;
        font-variant-ligatures: none;
        background-color: #0a0a0a; 
        color: #E5E7EB;
        font-family: "Departure", monospace;
        font-size: 22px;
        line-height: 22px;
      }
      body {
        margin: 0;
      }
      pre {
        display: block;
        margin: 0 auto;
        width: 70ch;
        position: relative;
        z-index: 1;
        font-variant-ligatures: none;
        background-color: #0a0a0a; 
        color: #E5E7EB;
        font-family: "Departure", monospace;
        font-size: 22px;
        line-height: 22px;
      }
      @font-face {
        font-family: "Departure";
        src: url("./public/departure.woff") format("woff");
      }
      #animation-content {
        opacity: 0;
        transition: opacity 0.3s ease-in;
      }
      #animation-content.loaded {
        color: #E5E7EB;
        opacity: 1;
      }
      a {
        color: #E5E7EB;
        text-decoration: none;
        transition: color 0.7s ease-out, opacity 0.7s ease-out;
      }
      a:hover {
        color: #FFFFFF;
        opacity: 0.9;
        transition: color 0.7s ease-out, opacity 0.7s ease-out;
      }
      #brand:hover {
        color: #FFFFFF;
        opacity: 0.9;
        transition: color 0.7s ease-out, opacity 0.7s ease-out;
      }

      /* Blink animation for bracket and arrow accents */
      @keyframes blink {
        0%, 49% { opacity: 1; }
        50%, 100% { opacity: 0; }
      }
      #brand:hover .brand-bracket {
        animation: blink 1s steps(1, end) infinite;
      }
      a[href^="mailto:"]:hover .mail-arrow {
        animation: blink 1s steps(1, end) infinite;
      }
      
      /* Subtle visual snow / static overlay */
      .noise-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 5;
        pointer-events: none;
        opacity: 0.105;
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
        background-size: 140px 140px;
        animation: noiseShift 0.35s steps(7, end) infinite;
      }

      @keyframes noiseShift {
        0%   { background-position:   0px   0px; }
        12%  { background-position: -20px  30px; }
        25%  { background-position: -60px  80px; }
        37%  { background-position:  40px -50px; }
        50%  { background-position:  80px -10px; }
        62%  { background-position: -30px  60px; }
        75%  { background-position:  50px  20px; }
        87%  { background-position: -70px -40px; }
        100% { background-position:   0px   0px; }
      }

      @media (prefers-reduced-motion: reduce) {
        .noise-overlay { animation: none; opacity: 0.07; }
      }
    </style>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>automatethestack.com</title>
   </head>
<body>
<div class="noise-overlay" aria-hidden="true"></div>
<pre>
                                  ..
╔════════════════════════════════════════════════════════════════════╗
║                      <a href="#" id="brand"><span class="brand-bracket">>></span> automate the stack <span class="brand-bracket"><<</span></a>                      ║
╚════════════════════════════════════════════════════════════════════╝
<span id="animation-content">LOADING</span>
╔════════════════════════════════════════════════════════════════════╗
║              <a href="mailto:info@automatethestack.com"><span class="mail-arrow">✧</span> contact ─→ info@automatethestack.com <span class="mail-arrow">✧</span></a>              ║
╚════════════════════════════════════════════════════════════════════╝
                                  ..
</pre>
<script>
// Animation Manager 
class AnimationManager {
  constructor(callback, fps = 10) {
    this._animation = null;
    this.callback = callback;
    this.lastFrame = -1;
    this.frameTime = 1000 / fps; // FPS CONTROL: Change fps parameter to adjust animation speed
  }

  // FPS CONTROL: Call this method to dynamically change FPS after initialization
  // Example: animationManager.updateFPS(20) for 20 FPS
  updateFPS(fps) {
    this.frameTime = 1000 / fps;
  }

  start() {
    if (this._animation != null) return;
    this._animation = requestAnimationFrame(this.update.bind(this));
  }

  pause() {
    if (this._animation == null) return;
    this.lastFrame = -1;
    cancelAnimationFrame(this._animation);
    this._animation = null;
  }

  update(time) {
    const { lastFrame } = this;
    let delta = time - lastFrame;
    
    if (this.lastFrame === -1) {
      this.lastFrame = time;
    } else {
      while (delta >= this.frameTime) {
        this.callback();
        delta -= this.frameTime;
        this.lastFrame += this.frameTime;
      }
    }
    
    this._animation = requestAnimationFrame(this.update.bind(this));
  }
}

// Main animation logic
(async function initAnimation() {
  const animationContent = document.getElementById('animation-content');
  let frames = [];
  let currentFrame = 0;
  let animationManager = null;

  try {
    // Fetch frames.json (either 70 char or 420 char version)
    const response = await fetch('./public/frames-70-char.json');
    if (!response.ok) {
      throw new Error(`Failed to load frames: ${response.status}`);
    }
    
    frames = await response.json();
    console.log(`Loaded ${frames.length} animation frames`);

    // Initialize animation manager
    // FPS CONTROL: Change the second parameter (currently 10) to adjust FPS
    // Examples: 5 = slower (5 FPS), 20 = faster (20 FPS), 30 = smooth (30 FPS)
    let baseFPS = 10; // Base FPS for animation
    animationManager = new AnimationManager(() => {
      currentFrame = (currentFrame + 1) % frames.length;
      animationContent.textContent = frames[currentFrame].join('\n');
    }, baseFPS); // CHANGE baseFPS to modify the default animation speed

    // Set initial frame
    animationContent.textContent = frames[0].join('\n');
    animationContent.classList.add('loaded');

    // Lightweight, occasional FPS randomization for subtle variation
    // Randomly varies FPS by ±2 every 4–8 seconds for a lively feel
    function scheduleFpsJitter() {
      const nextInMs = 4000 + Math.random() * 4000; // 4-8s
      setTimeout(() => {
        const jitter = (Math.random() * 4) - 2; // -2..+2
        const newFps = Math.max(5, Math.min(30, baseFPS + jitter));
        animationManager.updateFPS(newFps);
        scheduleFpsJitter();
      }, nextInMs);
    }
    scheduleFpsJitter();

    // Click-to-cycle FPS on title
    const brandEl = document.getElementById('brand');
    if (brandEl) {
      const fpsOptions = [5, 10, 15, 20, 24, 30];
      let fpsIndex = Math.max(0, fpsOptions.indexOf(baseFPS));
      brandEl.addEventListener('click', (e) => {
        e.preventDefault();
        fpsIndex = (fpsIndex + 1) % fpsOptions.length;
        baseFPS = fpsOptions[fpsIndex];
        animationManager.updateFPS(baseFPS);
      });
    }

    // Start animation if page is visible
    const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!reducedMotion) {
      animationManager.start(); // Always start animation regardless of visibility
    }

    // Removed focus/blur and visibilitychange event listeners to allow
    // animation to continue running even when window is not active.
    // This increases CPU usage but ensures continuous animation.
    // To re-enable performance optimization (pause when inactive), uncomment:
    
    // window.addEventListener('focus', () => animationManager.start());
    // window.addEventListener('blur', () => animationManager.pause());
    // document.addEventListener('visibilitychange', () => {
    //   if (document.visibilityState === 'visible') {
    //     animationManager.start();
    //   } else {
    //     animationManager.pause();
    //   }
    // });

  } catch (error) {
    console.error('Animation initialization failed:', error);
    animationContent.textContent = 'Failed to load animation. Please refresh the page.';
  }
})();
</script>
   </body>
</html>